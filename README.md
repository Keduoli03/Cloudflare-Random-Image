# Cloudflare Random Image

ä½¿ç”¨ Cloudflare è§„åˆ™å®ç°çš„ä¸é™è¯·æ±‚æ¬¡æ•°çš„éšæœºå›¾ç‰‡ APIã€‚

> æœ¬é¡¹ç›® Fork å¹¶ä¿®æ”¹è‡ª [Mabbs/cf-hitokoto](https://github.com/Mabbs/cf-hitokoto)ï¼Œæ ¸å¿ƒæ€è·¯æºäºåŸä½œè€…ã€‚
> æœ¬é¡¹ç›®å°†å…¶æ”¹é€ ä¸º**éšæœºå›¾ç‰‡**åˆ†å‘æœåŠ¡ï¼Œæ”¯æŒè‡ªåŠ¨æ‰«æä»“åº“å›¾ç‰‡ã€æ¨ªç«–å±åˆ†ç±»ï¼Œå¹¶ç»“åˆ jsDelivr CDN åŠ é€Ÿã€‚

## âœ¨ ç‰¹æ€§

*   **æ— é™è¯·æ±‚**: ä¾æ‰˜ Cloudflare è¾¹ç¼˜è®¡ç®—è§„åˆ™ï¼Œä¸æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œç†è®ºä¸Šæ—  QPS é™åˆ¶ã€‚
*   **è‡ªåŠ¨ç»´æŠ¤**: åªéœ€å°†å›¾ç‰‡ä¸Šä¼ åˆ° `Image/` ç›®å½•ï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ‰«æå¹¶ç”Ÿæˆç´¢å¼•ã€‚
*   **æ™ºèƒ½åˆ†ç±»**: è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡å®½é«˜æ¯”ï¼Œæä¾›â€œæ¨ªå± (Landscape)â€å’Œâ€œç«–å± (Portrait)â€åˆ†ç±»æ¥å£ã€‚
*   **CDN åŠ é€Ÿ**: å›¾ç‰‡èµ„æºé€šè¿‡ jsDelivr å…¨çƒåŠ é€Ÿ (å¯é…ç½®)ã€‚

## ğŸš€ éƒ¨ç½²æ–¹æ³•

### 1. å‡†å¤‡ä»“åº“
Fork æœ¬ä»“åº“åˆ°ä½ çš„ GitHub è´¦å·ã€‚

### 2. ä¸Šä¼ å›¾ç‰‡
å°†ä½ çš„å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ åˆ° `Image/` æ–‡ä»¶å¤¹ä¸­ï¼ˆæ”¯æŒ .jpg, .png, .webp, .gif ç­‰ï¼‰ã€‚
*å»ºè®®ï¼šä¸ºäº†è·å¾—æœ€ä½³ä½“éªŒï¼Œè¯·ç¡®ä¿æ–‡ä»¶åä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€‚*

### 3. ä¿®æ”¹é…ç½®
ä¿®æ”¹ `gen_advanced.py` æ–‡ä»¶é¡¶éƒ¨çš„é…ç½®åŒºåŸŸï¼š

```python
# ä½ çš„ GitHub ç”¨æˆ·å/ä»“åº“/åˆ†æ”¯
REPO_USER = "ä½ çš„ç”¨æˆ·å"
REPO_NAME = "ä»“åº“åç§°"
BRANCH = "main"
```

### 4. å¼€å¯ GitHub Pages
åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­ï¼š`Settings` -> `Pages` -> `Build and deployment`
*   **Source**: é€‰æ‹© `GitHub Actions`

### 5. æ¨é€ä»£ç 
æäº¤æ›´æ”¹å¹¶æ¨é€åˆ° GitHubï¼Œç­‰å¾… Actions æ„å»ºå®Œæˆã€‚æ„å»ºæˆåŠŸåï¼Œä½ å¯ä»¥åœ¨ Actions æ—¥å¿—æˆ–ç”Ÿæˆçš„ `rules.txt` (éƒ¨ç½²åçš„ç½‘é¡µè·¯å¾„) ä¸­æ‰¾åˆ° Cloudflare è§„åˆ™ã€‚

### 6. é…ç½® Cloudflare
åœ¨ Cloudflare åå°ï¼Œè¿›å…¥ä½ çš„åŸŸåç®¡ç†é¡µé¢ï¼š
1.  **Rules** -> **Transform Rules** -> **Rewrite URL** -> **Create rule**
2.  **Rule name**: Random Image
3.  **When incoming requests match**: `Hostname` equals `ä½ çš„åŸŸå` (æˆ–è€…æ ¹æ®éœ€è¦è®¾ç½®)
4.  **Path Rewrite** -> **Rewrite to ...** -> **Dynamic**
5.  å¡«å…¥ä¸‹æ–¹ç”Ÿæˆçš„è§„åˆ™è¡¨è¾¾å¼ã€‚

#### Cloudflare è§„åˆ™è¡¨è¾¾å¼

è¯·è®¿é—® `https://ä½ çš„åŸŸå/rules.txt` è·å–æœ€æ–°ç”Ÿæˆçš„è§„åˆ™ï¼Œå®ƒä¼šæ ¹æ®ä½ çš„å›¾ç‰‡æ•°é‡è‡ªåŠ¨è°ƒæ•´ã€‚

**é€šç”¨æ ¼å¼å‚è€ƒï¼š**

*   **Random Rule (å…¨éšæœº)**:
    ```javascript
    concat("/all/", substring(uuidv4(cf.random_seed), 0, 2), ".json")
    ```
    *(æ³¨æ„ï¼š`2` æ˜¯æ ¹æ®å›¾ç‰‡æ•°é‡è‡ªåŠ¨è®¡ç®—çš„ Hex é•¿åº¦)*

*   **Category Rule (å¸¦åˆ†ç±»)**:
    ```javascript
    concat("/categories/", substring(http.request.uri.query, 2, 1), "/", substring(uuidv4(cf.random_seed), 0, 2), ".json")
    ```

## ğŸ”Œ API ç”¨æ³•

è¯·æ±‚åœ°å€ï¼š`https://ä½ çš„åŸŸå/`

### å‚æ•°è¯´æ˜

| å‚æ•° | å€¼ | è¯´æ˜ | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- |
| **c** | `l` | è·å–**æ¨ªå±**å›¾ç‰‡ (Landscape) | `?c=l` |
| **c** | `p` | è·å–**ç«–å±**å›¾ç‰‡ (Portrait) | `?c=p` |
| (æ— ) | (æ— ) | è·å–**å…¨åº“éšæœº**å›¾ç‰‡ | (ä¸å¸¦å‚æ•°) |

### è¿”å›ç¤ºä¾‹ (JSON)

```json
{
  "url": "https://gcore.jsdelivr.net/gh/Keduoli03/Cloudflare-Random-Image@main/image/example.jpg",
  "type": "landscape"
}
```

*   `url`: å›¾ç‰‡çš„ç›´é“¾åœ°å€ (å·²æ‹¼æ¥ CDN)ã€‚
*   `type`: å›¾ç‰‡ç±»å‹ï¼Œ`landscape` (æ¨ªå±) æˆ– `portrait` (ç«–å±)ã€‚
